!function(){"use strict";var t=!("undefined"!=typeof module&&module.exports),e=t?window.pathy:require("pathy"),o=function(){function t(e){return this instanceof t?void(this.type=e):new t(e)}function o(t,e){}function i(t){return this instanceof i?void(this.paths=t):new i(t)}function n(t,e,o){this.objectFactory=t,this.collectionFactory=e,this.valueFactory=o}function r(t,o){this.name=t,this.type=o,this.accessor=e(t)}function s(t){this.cast=t}function a(t,e){this.name="ValidationError",this.message=t,this.error=e||null}function c(t){return t}function u(t,e){return this instanceof u?(this.type="function"==typeof t?new s(t):t,this.options=e||{},this.validators=[],void this.validators.push(function(t){if(null===t||void 0===t){if(this.options.optional)return!0;throw new a("Value cannot be null.")}})):new u(t,e)}function p(t){this.view=t,this.reset()}function l(t){function e(e){return"object"==typeof e&&null!==e?"array"===y(t)?i(array):o(e):e}function o(t){return Object.keys(t).map(function(o){return{key:o,value:e(t[o])}}).reduce(function(t,e){return t[e.key]=e.value,t},{})}function i(t){return t.map(function(t){return e(t)})}return e(t)}function h(t,e){function o(t,e){for(var o=Object.keys(e),n=0,r=o.length;r>n;n++)i(t,o[n],e[o[n]])}function i(t,e,i){var r=t[e];if(void 0!==i)return"object"==typeof r&&null!==r&&"object"==typeof i&&null!==i?void n.push({dest:r,src:i,merge:o}):void(t[e]=i)}if(!t||"object"!=typeof t)return t;for(var n=[],r=Array.prototype.slice.call(arguments,1),s=0,a=r.length;a>s;s++)r[s]&&"object"==typeof r[s]&&n.push({dest:t,src:r[s],merge:o});for(;n.length>0;){var c=n.pop();c.merge(c.dest,c.src)}return t}function y(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}var f={};return f.Schema=function(e){var o=new n(i,t,u),r=o.isValueNode;return o.isValueNode=function(t){return r.call(this,t)||t instanceof i},o.parse(e)},f.CollectionSchema=t,t.prototype.cast=function(t){if(void 0===t&&(t=null),"array"===y(t)){var e=this.type;return t.map(function(t){return e.cast(t)})}return[]},t.prototype.validate=function(t){if("array"!==y(t))throw new a("Value must be an array.");var e=this.type;t.forEach(function(t,o){try{e.validate(t)}catch(i){throw new a("The item at index "+o+" is invalid.",i)}})},f.Model=o,f.ObjectSchema=i,i.prototype.cast=function(t){return void 0===t&&(t=null),this.paths.reduce(function(e,o){return o.set(e,o.type.cast(o.get(t))),e},{})},i.prototype.validate=function(t){this.paths.forEach(function(e){try{e.type.validate(e.get(t))}catch(o){throw new a("The value at "+e.name+" is invalid.")}})},f.SchemaParser=n,n.prototype.parse=function(t){return this.isCollectionNode(t)?this.collectionSchemaFromNode(t):this.objectFactory(this.pathsFromNode("",t))},n.prototype.pathsFromNode=function(t,e){if(void 0===e)return[];if(this.isCollectionNode(e))return[new r(t,this.collectionSchemaFromNode(e))];if(e=this.parseValue(e),this.isValueNode(e))return[new r(t,this.valueFactory(e))];if(this.isValueNodeWithOptions(e))return[new r(t,this.valueFactory(e.type,this.optionsFromNode(e)))];var o=this;return Object.keys(e).map(function(i){return o.pathsFromNode(t?t+"."+i:i,e[i])}).reduce(function(t,e){return t.concat(e)},[])},n.prototype.parseValue=function(t){return this.isValueNode(t)?t:null===t?c:"boolean"==typeof t?Boolean:"string"==typeof t?String:"number"==typeof t?Number:"array"===y(t)&&0===t.length?Array:0===Object.keys(t).length?Object:t},n.prototype.collectionSchemaFromNode=function(t){return this.isTypeNodeWithOptions(t)?this.valueFactory(this.collectionFactory(this.collectionTypeFromNode(t.type)),this.optionsFromNode(t)):this.valueFactory(this.collectionFactory(this.collectionTypeFromNode(t)))},n.prototype.collectionTypeFromNode=function(t){return"array"===y(t)&&t.length>0?(t=t[0],this.isValueNode(t)?this.valueFactory(t):this.isValueNodeWithOptions(t)?this.valueFactory(t.type,this.optionsFromNode(t[0])):this.parse(t)):this.valueFactory(c)},n.prototype.isCollectionNode=function(t){return t===Array||"array"===y(t)||this.isTypeNodeWithOptions(t)&&(t.type===Array||"array"===y(t.type))},n.prototype.isValueNodeWithOptions=function(t){return"object"==typeof t&&null!==t&&this.isValueNode(t.type)},n.prototype.isValueNode=function(t){return"function"==typeof t},n.prototype.isTypeNodeWithOptions=function(t){return"object"==typeof t&&null!==t&&(this.isValueNode(t.type)||"array"===y(t.type))},n.prototype.optionsFromNode=function(t){var e=l(t);return delete e.type,e},f.SchemaPath=r,r.prototype.get=function(t){return this.accessor.get(t)},r.prototype.set=function(t,e){this.accessor.set(t,e)},s.prototype.validate=function(){},f.ValidationError=a,a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,f.ValueSchema=u,f.Any=c,u.prototype.cast=function(t){return void 0===t&&(t=null),this.options.optional&&null===t?null:this.type.cast(t)},u.prototype.validate=function(t){for(var e=0,o=this.validators.length;o>e;e++)if(this.validators[e].call(this,t)===!0)return;this.type.validate(t)},f.View=p,p.prototype.get=function(t){var o=e(t).get(this._local);return void 0===o&&this.view?this.view.get(t):o},p.prototype.set=function(t,o){e(t).set(this._local,o)},p.prototype.reset=function(){this._local={}},p.prototype.merge=function(t){h(this._local,t)},p.prototype.commit=function(){if(!this.view)throw new Error("No subview to commit to!");this.view.merge(this._local),this.reset()},p.prototype.toJSON=function(){return h(l(this._local),this.view&&this.view.toJSON()||{})},f.util={cloneDeep:l,merge:h},f}();t?("function"==typeof define&&define.amd&&define(function(){return o}),window.model=o):module.exports=o}();