!function(){"use strict";var t=!("undefined"!=typeof module&&module.exports),e=t?window.pathy:require("pathy"),n=function(){function t(t,e){this.type=t,this.options=e||{}}function n(t,e){return u(t)?i(t):(this.paths=[],this.options=e||{},void(this.paths=o("",t)))}function o(t,e){return void 0===e?[]:u(e)?[new s(t,i(e))]:(e=r(e),"function"==typeof e?[new s(t,new p(e))]:"function"==typeof e.type?[new s(t,new p(e.type,a(e)))]:Object.keys(e).map(function(n){return o(t?t+"."+n:n,e[n])}).reduce(function(t,e){return t.concat(e)},[]))}function r(t){return t instanceof n||"function"==typeof t?t:"boolean"==typeof t?Boolean:"string"==typeof t?String:"number"==typeof t?Number:"array"===d(t)&&0===t.length?Array:null===t||0===Object.keys(t).length?Object:t}function i(e){return"array"===d(e)&&e.length>0?(e=e[0],new t("function"==typeof e?new p(e):c(e)?new p(e.type,a(e[0])):new n(e))):new t(Object)}function u(t){return t===Array||"array"===d(t)||c(t)&&(t.type===Array||"Array"===d(t.type))}function c(t){return"object"==typeof t&&null!==t&&"function"==typeof t.type}function a(t){var e=h(t);return delete e.type,e}function s(t,n){this.name=t,this.type=n,this.accessor=e(t)}function l(t,e){this.name="ValidationError",this.message=t,this.error=e||null}function p(t,e){this.caster=t,this.options=e||{}}function f(t){this.view=t,this.reset()}function h(t){function e(e){return"object"==typeof e&&null!==e?"array"===d(t)?o(array):n(e):e}function n(t){return Object.keys(t).map(function(n){return{key:n,value:e(t[n])}}).reduce(function(t,e){return t[e.key]=e.value,t},{})}function o(t){return t.map(function(t){return e(t)})}return e(t)}function y(t,e){function n(t,e){for(var n=Object.keys(e),r=0,i=n.length;i>r;r++)o(t,n[r],e[n[r]])}function o(t,e,o){var i=t[e];if(void 0!==o)return"object"==typeof i&&null!==i&&"object"==typeof o&&null!==o?void r.push({dest:i,src:o,merge:n}):void(t[e]=o)}if(!t||"object"!=typeof t)return t;for(var r=[],i=Array.prototype.slice.call(arguments,1),u=0,c=i.length;c>u;u++)i[u]&&"object"==typeof i[u]&&r.push({dest:t,src:i[u],merge:n});for(;r.length>0;){var a=r.pop();a.merge(a.dest,a.src)}return t}function d(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}var v={};return v.CollectionSchema=t,t.prototype.cast=function(t){if(void 0===t&&(t=null),this.options.optional&&null===t)return null;var e=this;return"array"===d(t)?t.map(function(t){return e.type.cast(t)}):[]},t.prototype.validate=function(t){if(null===t||void 0===t){if(this.options.optional)return;throw new l("Value cannot be null.")}if("array"!==d(t))throw new l("Value must be an array.");var e=this;t.forEach(function(t,n){try{e.validate(t)}catch(o){throw new l("The item at index "+n+" is invalid.",o)}})},v.Schema=n,n.prototype.cast=function(t){return void 0===t&&(t=null),this.options.optional&&null===t?null:this.paths.reduce(function(e,n){return n.set(e,n.type.cast(n.get(t))),e},{})},n.prototype.validate=function(t){if(null===t||void 0===t){if(this.options.optional)return;throw new l("Value cannot be null.")}if("object"!==d(t))throw new l("Value must be an object.");this.paths.forEach(function(e){try{e.type.validate(e.get(t))}catch(n){throw new l("The value at "+e.name+" is invalid.")}})},v.SchemaPath=s,s.prototype.get=function(t){return this.accessor.get(t)},s.prototype.set=function(t,e){this.accessor.set(t,e)},v.ValidationError=l,l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,v.ValueSchema=p,p.prototype.cast=function(t){return void 0===t&&(t=null),this.options.optional&&null===t?null:this.caster(t)},p.prototype.validate=function(t){if(null===t||void 0===t){if(this.options.optional)return;throw new l("Value cannot be null.")}},v.View=f,f.prototype.get=function(t){var n=e(t).get(this._local);return void 0===n&&this.view?this.view.get(t):n},f.prototype.set=function(t,n){e(t).set(this._local,n)},f.prototype.reset=function(){this._local={}},f.prototype.merge=function(t){y(this._local,t)},f.prototype.commit=function(){if(!this.view)throw new Error("No subview to commit to!");this.view.merge(this._local),this.reset()},f.prototype.toJSON=function(){return y(h(this._local),this.view&&this.view.toJSON()||{})},v.util={cloneDeep:h,merge:y},v}();t?("function"==typeof define&&define.amd&&define(function(){return n}),window.model=n):module.exports=n}();