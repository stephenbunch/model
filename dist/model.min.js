!function(){"use strict";var t=!("undefined"!=typeof module&&module.exports),e=t?window.pathy:require("pathy"),o=function(){function t(e){return this instanceof t?void(this.type=e):new t(e)}function o(t,e){}function r(t){return this instanceof r?void(this.paths=t):new r(t)}function n(e){return this instanceof n?(e=e||{},this.objectFactory=e.objectFactory||r,this.collectionFactory=e.collectionFactory||t,this.valueFactory=e.valueFactory||u,this.pathFactory=e.pathFactory||i,void(this.typeMatchers=e.typeMatchers||[function(t){return t instanceof r}])):new n(e)}function i(t,o){return this instanceof i?(this.name=t,this.type=o,void(this.accessor=e(t))):new i(t,o)}function a(t){this.cast=t}function c(t,e){this.name="ValidationError",this.message=t,this.error=e||null}function s(t){return t}function u(t,e){return this instanceof u?(this.type="function"==typeof t?new a(t):t,this.options=e||{},this.validators=[],void this.validators.push(function(t){if(null===t||void 0===t){if(this.options.optional)return!0;throw new c("Value cannot be null.")}})):new u(t,e)}function p(t){this.view=t,this.reset()}function h(t){function e(e){return"object"==typeof e&&null!==e?"array"===y(t)?r(array):o(e):e}function o(t){return Object.keys(t).map(function(o){return{key:o,value:e(t[o])}}).reduce(function(t,e){return t[e.key]=e.value,t},{})}function r(t){return t.map(function(t){return e(t)})}return e(t)}function l(t,e){function o(t,e){for(var o=Object.keys(e),n=0,i=o.length;i>n;n++)r(t,o[n],e[o[n]])}function r(t,e,r){var i=t[e];if(void 0!==r)return"object"==typeof i&&null!==i&&"object"==typeof r&&null!==r?void n.push({dest:i,src:r,merge:o}):void(t[e]=r)}if(!t||"object"!=typeof t)return t;for(var n=[],i=Array.prototype.slice.call(arguments,1),a=0,c=i.length;c>a;a++)i[a]&&"object"==typeof i[a]&&n.push({dest:t,src:i[a],merge:o});for(;n.length>0;){var s=n.pop();s.merge(s.dest,s.src)}return t}function y(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}var f={},d=new n;return f.Schema=function(t){return d.parse(t)},f.CollectionSchema=t,t.prototype.cast=function(t){if(void 0===t&&(t=null),"array"===y(t)){var e=this.type;return t.map(function(t){return e.cast(t)})}return[]},t.prototype.validate=function(t){if("array"!==y(t))throw new c("Value must be an array.");var e=this.type;t.forEach(function(t,o){try{e.validate(t)}catch(r){throw new c("The item at index "+o+" is invalid.",r)}})},f.Model=o,f.ObjectSchema=r,r.prototype.cast=function(t){return void 0===t&&(t=null),this.paths.reduce(function(e,o){return o.set(e,o.type.cast(o.get(t))),e},{})},r.prototype.validate=function(t){this.paths.forEach(function(e){try{e.type.validate(e.get(t))}catch(o){throw new c("The value at "+e.name+" is invalid.")}})},f.SchemaParser=n,n.prototype.parse=function(t){return this.isValueNode(t)?this.valueFromNode(t):this.objectFactory(this.pathsFromNode("",t))},n.prototype.pathsFromNode=function(t,e){if(void 0===e)return[];if(this.isValueNode(e))return[this.pathFactory(t,this.valueFromNode(e))];var o=this;return Object.keys(e).map(function(r){return o.pathsFromNode(t?t+"."+r:r,e[r])}).reduce(function(t,e){return t.concat(e)},[])},n.prototype.isTypeNode=function(t){var e="function"==typeof t||"array"===y(t);if(!e)for(var o=0,r=this.typeMatchers.length;r>o&&!e;o++)e=this.typeMatchers[o](t);return e},n.prototype.isTypeNodeWithOptions=function(t){return"object"==typeof t&&null!==t&&this.isTypeNode(t.type)},n.prototype.optionsFromNode=function(t){var e=h(t);return delete e.type,e},n.prototype.typeFromNode=function(t){return this.isCollectionType(t)?this.collectionFromNode(t):t},n.prototype.isCollectionType=function(t){return t===Array||"array"===y(t)},n.prototype.isValueNode=function(t){return this.isTypeNode(t)||this.isTypeNodeWithOptions(t)},n.prototype.valueFromNode=function(t){return this.isTypeNodeWithOptions(t)?this.valueFactory(this.typeFromNode(t.type),this.optionsFromNode(t)):this.valueFactory(this.typeFromNode(t))},n.prototype.collectionFromNode=function(t){return this.collectionFactory("array"===y(t)&&t.length>0?this.valueFromNode(t[0]):this.valueFactory(s))},f.SchemaPath=i,i.prototype.get=function(t){return this.accessor.get(t)},i.prototype.set=function(t,e){this.accessor.set(t,e)},a.prototype.validate=function(){},f.ValidationError=c,c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,f.ValueSchema=u,f.Any=s,u.prototype.cast=function(t){return void 0===t&&(t=null),this.options.optional&&null===t?null:this.type.cast(t)},u.prototype.validate=function(t){for(var e=0,o=this.validators.length;o>e;e++)if(this.validators[e].call(this,t)===!0)return;this.type.validate(t)},f.View=p,p.prototype.get=function(t){var o=e(t).get(this._local);return void 0===o&&this.view?this.view.get(t):o},p.prototype.set=function(t,o){e(t).set(this._local,o)},p.prototype.reset=function(){this._local={}},p.prototype.merge=function(t){l(this._local,t)},p.prototype.commit=function(){if(!this.view)throw new Error("No subview to commit to!");this.view.merge(this._local),this.reset()},p.prototype.toJSON=function(){return l(h(this._local),this.view&&this.view.toJSON()||{})},f.util={cloneDeep:h,merge:l},f}();t?("function"==typeof define&&define.amd&&define(function(){return o}),window.model=o):module.exports=o}();